---
layout: default
---

<article class="weekly-report">
  <header class="report-header">
    {% if page.image %}
    <div class="hero-image">
      <img src="{{ page.image }}" alt="{{ page.title }}">
    </div>
    {% endif %}

    <div class="header-content">
      <div class="report-meta">
        <span class="week-badge">Week {{ page.week_number }}, {{ page.date | date: "%Y" }}</span>
        <span class="threat-level threat-{{ page.threat_level | downcase | replace: ' ', '-' }}">
          Threat Level: {{ page.threat_level }}
        </span>
      </div>
      <h1>{{ page.title }}</h1>
      <p class="date-range">{{ page.week_start }} - {{ page.week_end }}</p>
    </div>
  </header>

  <!-- Charts Section -->
  {% if page.chart_data %}
  <section class="charts-section">
    <h2>Week at a Glance</h2>

    <div class="charts-grid">
      <!-- Daily Activity Chart -->
      <div class="chart-container">
        <h3>Daily Activity</h3>
        <canvas id="dailyChart"></canvas>
      </div>

      <!-- Events by Type -->
      <div class="chart-container">
        <h3>Events by Type</h3>
        <canvas id="typeChart"></canvas>
      </div>

      <!-- Events by Severity -->
      <div class="chart-container">
        <h3>Events by Severity</h3>
        <canvas id="severityChart"></canvas>
      </div>

      <!-- Week Comparison -->
      <div class="chart-container">
        <h3>Week-over-Week</h3>
        <canvas id="comparisonChart"></canvas>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards">
      <div class="stat-card">
        <div class="stat-value">{{ page.chart_data.total_events }}</div>
        <div class="stat-label">Total Events</div>
      </div>
      <div class="stat-card {% if page.chart_data.week_change > 0 %}stat-up{% else %}stat-down{% endif %}">
        <div class="stat-value">
          {% if page.chart_data.week_change > 0 %}+{% endif %}{{ page.chart_data.week_change }}%
        </div>
        <div class="stat-label">vs Last Week</div>
      </div>
      <div class="stat-card stat-critical">
        <div class="stat-value">{{ page.chart_data.critical_count }}</div>
        <div class="stat-label">Critical Events</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ page.chart_data.air_events }}</div>
        <div class="stat-label">Air Incursions</div>
      </div>
    </div>
  </section>
  {% endif %}

  <section class="report-content">
    {{ content }}
  </section>

  <footer class="report-footer">
    <div class="share-section">
      <h4>Share this report</h4>
      <div class="share-buttons">
        <a href="https://twitter.com/intent/tweet?url={{ page.url | absolute_url }}&text={{ page.title | uri_escape }}" target="_blank" class="share-btn twitter">Twitter</a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ page.url | absolute_url }}&title={{ page.title | uri_escape }}" target="_blank" class="share-btn linkedin">LinkedIn</a>
      </div>
    </div>
    <p class="disclaimer">
      This report is automatically generated from <a href="https://taiwaninvasionalerts.com">Taiwan Invasion Alerts</a> data.
    </p>
  </footer>
</article>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% if page.chart_data %}
<script>
  // Chart colors matching site theme
  const colors = {
    primary: '#3b82f6',
    critical: '#dc2626',
    intel: '#f59e0b',
    routine: '#22c55e',
    air: '#60a5fa',
    naval: '#34d399',
    political: '#a78bfa',
    military: '#f87171',
    grid: '#334155',
    text: '#94a3b8'
  };

  Chart.defaults.color = colors.text;
  Chart.defaults.borderColor = colors.grid;

  // Daily Activity Chart
  const dailyData = {{ page.chart_data.daily | jsonify }};
  if (dailyData && dailyData.length > 0) {
    new Chart(document.getElementById('dailyChart'), {
      type: 'bar',
      data: {
        labels: dailyData.map(d => d.day),
        datasets: [{
          label: 'Events',
          data: dailyData.map(d => d.count),
          backgroundColor: colors.primary,
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, grid: { color: colors.grid } },
          x: { grid: { display: false } }
        }
      }
    });
  }

  // Events by Type Chart
  const typeData = {{ page.chart_data.by_type | jsonify }};
  if (typeData && typeData.length > 0) {
    new Chart(document.getElementById('typeChart'), {
      type: 'doughnut',
      data: {
        labels: typeData.map(d => d.name.charAt(0).toUpperCase() + d.name.slice(1)),
        datasets: [{
          data: typeData.map(d => d.value),
          backgroundColor: [colors.air, colors.naval, colors.political, colors.military, '#64748b']
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });
  }

  // Events by Severity Chart
  const severityData = {{ page.chart_data.by_severity | jsonify }};
  if (severityData && severityData.length > 0) {
    new Chart(document.getElementById('severityChart'), {
      type: 'doughnut',
      data: {
        labels: severityData.map(d => d.name.charAt(0).toUpperCase() + d.name.slice(1)),
        datasets: [{
          data: severityData.map(d => d.value),
          backgroundColor: [colors.critical, colors.intel, colors.routine]
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom' } }
      }
    });
  }

  // Week Comparison Chart
  const thisWeek = {{ page.chart_data.total_events | default: 0 }};
  const lastWeek = {{ page.chart_data.last_week_events | default: 0 }};
  new Chart(document.getElementById('comparisonChart'), {
    type: 'bar',
    data: {
      labels: ['Last Week', 'This Week'],
      datasets: [{
        data: [lastWeek, thisWeek],
        backgroundColor: [colors.grid, colors.primary],
        borderRadius: 4
      }]
    },
    options: {
      responsive: true,
      indexAxis: 'y',
      plugins: { legend: { display: false } },
      scales: {
        x: { beginAtZero: true, grid: { color: colors.grid } },
        y: { grid: { display: false } }
      }
    }
  });
</script>
{% endif %}

<style>
.weekly-report {
  max-width: 900px;
  margin: 0 auto;
  overflow-x: hidden;
}

.hero-image {
  width: 100%;
  max-height: 400px;
  overflow: hidden;
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

.hero-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.header-content {
  margin-bottom: 2rem;
}

.report-meta {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.week-badge {
  background: var(--accent-color, #3b82f6);
  color: white;
  padding: 0.375rem 1rem;
  border-radius: 4px;
  font-weight: 600;
  font-size: 0.875rem;
}

.threat-level {
  padding: 0.375rem 1rem;
  border-radius: 4px;
  font-weight: 600;
  font-size: 0.875rem;
}

.threat-high, .threat-elevated { background: #dc2626; color: white; }
.threat-moderate { background: #f59e0b; color: black; }
.threat-low { background: #22c55e; color: white; }

.report-header h1 {
  font-size: 2rem;
  margin: 0 0 0.5rem 0;
  line-height: 1.2;
}

.date-range {
  color: var(--text-secondary, #94a3b8);
  font-size: 1.1rem;
}

/* Charts Section */
.charts-section {
  background: var(--bg-secondary, #1e293b);
  border: 1px solid var(--border-color, #334155);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  overflow: hidden;
}

.charts-section h2 {
  margin: 0 0 1.5rem 0;
  font-size: 1.25rem;
  color: var(--text-primary, #f1f5f9);
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
  margin-bottom: 1.5rem;
  min-width: 0;
}

@media (max-width: 640px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }
}

.chart-container {
  background: var(--bg-primary, #0f172a);
  border-radius: 8px;
  padding: 1rem;
  overflow: hidden;
  min-width: 0;
}

.chart-container h3 {
  margin: 0 0 1rem 0;
  font-size: 0.875rem;
  color: var(--text-secondary, #94a3b8);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.chart-container canvas {
  max-height: 200px;
}

/* Stats Cards */
.stats-cards {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
}

@media (max-width: 640px) {
  .stats-cards {
    grid-template-columns: repeat(2, 1fr);
  }
}

.stat-card {
  background: var(--bg-primary, #0f172a);
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--text-primary, #f1f5f9);
}

.stat-up .stat-value { color: #dc2626; }
.stat-down .stat-value { color: #22c55e; }
.stat-critical .stat-value { color: #dc2626; }

.stat-label {
  font-size: 0.75rem;
  color: var(--text-secondary, #94a3b8);
  text-transform: uppercase;
  margin-top: 0.25rem;
}

/* Report Content */
.report-content {
  line-height: 1.8;
}

.report-content h2 {
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border-color, #334155);
}

/* Footer */
.report-footer {
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--border-color, #334155);
}

.share-section {
  margin-bottom: 1.5rem;
}

.share-section h4 {
  margin: 0 0 0.75rem 0;
  font-size: 0.875rem;
  color: var(--text-secondary, #94a3b8);
}

.share-buttons {
  display: flex;
  gap: 0.75rem;
}

.share-btn {
  padding: 0.5rem 1rem;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
  text-decoration: none;
  color: white;
}

.share-btn.twitter { background: #1da1f2; }
.share-btn.linkedin { background: #0077b5; }

.disclaimer {
  font-size: 0.875rem;
  color: var(--text-secondary, #94a3b8);
}

.disclaimer a {
  color: var(--accent-color, #3b82f6);
}
</style>
